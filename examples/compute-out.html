<script type='module'>
	import PokerHand from "../src/index.js"

	////////////////////////////////////////////////////////////////////////
	//		Code
	////////////////////////////////////////////////////////////////////////

	let holeCards = ['Ac', 'As']
	let communityCards = ['5c', '5c']
	let nSimulations = 1000
	let firstHand = PokerHand.Hand2.make(holeCards.concat(communityCards))
	let requireHandRank = firstHand.handRank + 1
	console.log(`firstHand ${firstHand.minimalCards} name ${firstHand.handName} rank ${firstHand.handRank}`)


	let outCards = computeOuts(holeCards, communityCards, requireHandRank, nSimulations)
	console.log(`nOuts ${outCards.length} outCards ${outCards}`)

	// let outCards = Array.from(outCardsSet).sort()
	// console.log(`nOuts ${outCards.length} outCards ${outCards}`)

	/**
	 * - the goal is to count the cards which improve your hands
	 * - First get a list of all cards which improve your hands
	 * - works IIF communityCards.length >= 3
	 */

	/**
	* - PokerHand seems to force the cards === 5... how to work around that
	*   - i want to be able to have the result on partial hand
	*   - possibility 1: add fake cards up to 5 cards
	*   - possibility 2: modify its code - but then i
	* - PokerHand/binion/machinePoker are all in coffeescript :(
	*   - i am not a fan of forking...
	*   - but the library is small and well coded
	*   - it is node.js only - due to require() and due to dependancy on npm packages
	* - port all this code... seems a lot of work... giving me nothing but better maintenance
	* - do i need to port every repository ?
	*   - is PokerHand enouth ? this one is super small
	*/


	function computeOuts(holeCards, communityCards, requireHandRank, nSimulations) {
		const outCardsSet = new Set();

		console.assert(holeCards.length === 2)
		console.assert(communityCards.length >= 0)

		for (let i = 0; i < nSimulations; i++) {
			let randomCard = PokerHand.Utils.pickUnusedCards(1, holeCards.concat(communityCards))
			// console.log(`draw cards ${randomCard}`)
			let newCommunityCards = communityCards.concat(randomCard)

			// console.log(`newCommunityCards ${newCommunityCards}`)

			let finalHand = PokerHand.Hand2.make(holeCards.concat(newCommunityCards))
			// let communityHand = PokerHand.Hand.make(newCommunityCards)
			// console.log(`finalHand ${finalHand.minimalCards} name ${finalHand.handName} rank ${finalHand.handRank}`)
			// console.log(`communityHand ${communityHand} name ${communityHand.handName} rank ${communityHand.handRank}`)

			let involvedMyHoleCards = finalHand.minimalCards.indexOf(holeCards[0]) !== -1
				|| finalHand.minimalCards.indexOf(holeCards[1]) !== -1

			if (finalHand.handRank >= requireHandRank && involvedMyHoleCards === true) {
				// console.log(`${randomCard} IS an out`)
				outCardsSet.add(randomCard.toString())
			} else {
				// console.log(`${randomCard} IS NOT an out`)
			}
		}

		let outCards = Array.from(outCardsSet).sort()
		// console.log(`nOuts ${outCards.length} outCards ${outCards}`)
		return outCards
	}
</script>